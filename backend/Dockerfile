FROM node:22-alpine

ARG BACKEND_ACCEPT_ORIGIN
ARG BACKEND_PORT
ARG PG_PORT
ARG PG_HOST
ARG PG_USER
ARG PG_PASSWORD
ARG PG_DATABASE

ENV BACKEND_ACCEPT_ORIGIN=${BACKEND_ACCEPT_ORIGIN}
ENV BACKEND_PORT=${BACKEND_PORT}
ENV PGPORT=${PG_PORT}
ENV PGHOST=${PG_HOST}
ENV PGUSER=${PG_USER}
ENV PGPASSWORD=${PG_PASSWORD}
ENV PGDATABASE=${PG_DATABASE}

WORKDIR /usr/src/types
COPY ./types ./
RUN npm i

WORKDIR /usr/src/features/core
COPY ./features/core ./
RUN npm i

WORKDIR /usr/src/infra/http
COPY ./infra/http ./
RUN npm i

WORKDIR /usr/src/app
COPY ./backend ./
RUN npm i

EXPOSE 3000

CMD ["npm", "start"]
